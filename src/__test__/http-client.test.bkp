// Suponiendo que tu archivo se llama fetchUrl.js
import { fetchUrl } from '../http-client';

import http, { IncomingMessage, ClientRequest } from 'http';
jest.mock('http');

describe('fetchUrl', () => {
  it('debe imprimir los datos recibidos', (done) => {
    const mockData = 'Respuesta de prueba';
    const response = {
      setEncoding: jest.fn(),
      on: jest.fn((event, handler) => {
        if (event === 'data') {
          handler(mockData);
        }
        if (event === 'end') {
          handler();
        }
      }),
    };
    http.get.mockImplementation((url:string | URL, callback: ClientRequest) => {
      callback(response);
      return { on: jest.fn() };
    });

    console.log = jest.fn();

    fetchUrl('http://test.com');

    process.nextTick(() => {
      expect(console.log).toHaveBeenCalledWith(mockData);
      done();
    });
  });

  // Puedes agregar más pruebas aquí para manejar otros casos, como errores.
});
