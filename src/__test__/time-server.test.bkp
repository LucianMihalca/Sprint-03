import net, { Socket } from "net";

import { padZero, formatDate, timeServer } from "../time-server";
jest.mock('net', () => ({
    createServer: jest.fn()
  }));
  
  describe('timeServer', () => {
    it('debería enviar la fecha y hora formateadas y cerrar la conexión', () => {
      let timeServer;
      jest.isolateModules(() => {
        timeServer = require('../path-to-your-time-server-file').timeServer;
      });
  
      const mockSocket = { end: jest.fn() };
      (net.createServer as jest.Mock).mockImplementation(callback => {
        callback(mockSocket);
        return { listen: jest.fn() };
      });
  
      // Asegúrate de que el servidor se haya creado y configurado
      expect(net.createServer).toHaveBeenCalled();
      expect(timeServer).toBeDefined();
  
      // Simula una conexión al servidor y verifica el comportamiento
      expect(mockSocket.end).toHaveBeenCalledWith(expect.any(String));
    });
  });